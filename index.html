<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Login Landing Page</title>
  <link rel="stylesheet" href="./style.css">

</head>

<body>

  <div class="login-page">
    <div class="form">
      <form class="register-form" onSubmit="register();return false">
        <input type="text" id="registerName" placeholder="name" />
        <input type="text" id="registerEmail" placeholder="email address" />
        <input type="password" id="registerPassword" placeholder="password" />
        <button type="submit">create</button>
        <p class="message">Already registered? <a href="#">Sign In</a></p>
      </form>
      <form class="login-form" onSubmit="login();return false">
        <input type="text" id="loginEmail" placeholder="email" />
        <input type="password" id="loginPassword" placeholder="password" />
        <button type="submit">login</button>
        <p class="message">Not registered? <a href="#">Create an account</a></p>
      </form>
    </div>
  </div>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src="./script.js"></script>
  <script type="text/javascript">

    async function login() {

      let email = document.getElementById('loginEmail').value;
      let password = document.getElementById('loginPassword').value;

      let user = await fetch('https://url-shortener-umesh.herokuapp.com/user/login', {
        method: "POST",
        mode: 'cors',
        body: JSON.stringify({
          "email":email,
          "password":password
        }),
        headers: {
          "Content-Type": "application/json",
        },
      });

      
      let logResult = await user.json();
      if (logResult.status === 200) {
        let token = logResult.token;
        localStorage.setItem('currentUserToken', token);
        localStorage.setItem('currentUserEmail', email);
        alert("Logged In Successfully");
        window.location.assign('./dashboard.html')
        //return true;
      }else{
        alert("There was a problem in signing in, Please try again");
      }
      //alert(logResult.message);
      //return false;
    }

    async function register() {

      let name = document.getElementById('registerName').value;
      let email = document.getElementById('registerEmail').value;
      let password = document.getElementById('registerPassword').value;

      let newUser = await fetch('https://url-shortener-umesh.herokuapp.com/user/signup', {
        method: "POST",
        mode: 'cors',
        body: JSON.stringify({
          "username": name,
          "email": email,
          "password": password
        }),
        headers: {
          "Content-Type": "application/json",
        },
      });

      let res = await newUser.json();
      if (res.status == 200) {
        alert("Successfully registered account")
        //window.location.assign('/')
      }else{
        alert("There was a problem in registering user, please try after some time");
      }
      //alert(res.message);
    }

  </script>
</body>

</html>